# ุชุญููู ูุดููุฉ ุงููุตู ุงูุฐูู - ุงูุชุนุฑู ุนูู ุงูุฃููุงุท

**ุงูุชุงุฑูุฎ:** 14 ููุงูุฑ 2026  
**ุงููุธุงู:** BGL3 v3.0 - ููุฒุฉ Smart Paste  
**ุงููุดููุฉ:** ุงุณุชุฎุฑุงุฌ ุฎุงุทุฆ ูุฃุณูุงุก ุงูุจููู ูู ูุตูุต ุนุดูุงุฆูุฉ

---

## ๐ ูุตู ุงููุดููุฉ ุงูุญุงููุฉ

### ูุง ูุญุฏุซ ุงูุขู

ุนูุฏ ุงุณุชุฎุฏุงู ููุฒุฉ "ุงููุตู ุงูุฐูู" (Smart Paste) ููุตู ูุต ูุง ูุญุชูู ุนูู ุจูุงูุงุช ุถูุงู ุญููููุฉุ ูุญุงูู ุงููุธุงู **ุงูุชุฎููู ุจุดูู ุนุฏูุงูู** ููุณุชุฎุฑุฌ ุฃุณูุงุก ุจููู ูุฏ ุชููู ุบูุฑ ุตุญูุญุฉ.

### ูุซุงู ุนูู ุงูุณููู ุงูุฎุงุทุฆ

**ุงููุต ุงูููุฏุฎู:**

```
ูุฐุง ูุต ุชุฌุฑูุจู ูุง ูุญุชูู ุนูู ุฃู ุจูุงูุงุช ุตุญูุญุฉ ููุถูุงู ุงูุจููู.
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**

- ุฌููุน ุงูุญููู ุชุธูุฑ โ (ุบูุฑ ูุณุชุฎุฑุฌุฉ)
- ุฃู ุฑุณุงูุฉ: "ูู ูุชู ุงูุชุนุฑู ุนูู ุจูุงูุงุช ุถูุงู ูู ุงููุต ุงูููุฏุฎู"

**ุงููุชูุฌุฉ ุงููุนููุฉ:**

- ูุฏ ูุณุชุฎุฑุฌ ุงููุธุงู ุงุณู ุจูู ูู ูููุฉ ุนุดูุงุฆูุฉ ุชุดุจู ุงุณู ุจูู
- ูุนุฑุถ โ ุจุฌูุงุฑ ุญูู "ุงุณู ุงูุจูู" ุฑุบู ุฃู ุงูุงุณุชุฎุฑุงุฌ ุฎุงุทุฆ

---

## ๐ ุฃูู ุงูุฎูู ุจุงูุถุจุทุ

### 1. ุงููุดููุฉ ุงูุชูููุฉ

ุงููุธุงู ูุณุชุฎุฏู **Fuzzy Matching** (ุงููุทุงุจูุฉ ุงูุชูุฑูุจูุฉ) ูุงุณุชุฎุฑุงุฌ ุฃุณูุงุก ุงูุจููู ูู ุงููุต. ูุฐุง ูุนูู:

- ูุจุญุซ ุนู ูููุงุช **ุชุดุจู** ุฃุณูุงุก ุงูุจููู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ุญุชู ูู ูู ุชูู ูุทุงุจูุฉ ุชูุงูุงูุ ูุฏ ูุนุชุจุฑูุง "ุชุทุงุจู ูุญุชูู"
- **ูุง ููุฌุฏ ุญุฏ ุฃุฏูู ููุซูุฉ** (Confidence Threshold) ูุฑูุถ ุงููุชุงุฆุฌ ุงูุถุนููุฉ

### 2. ุงููุดููุฉ ูู ููุธูุฑ ุงููุณุชุฎุฏู

**ุงูุณููุงุฑูู ุงูุฎุทุฑ:**

1. ููุธู ููุตู ุจุฑูุฏ ุฅููุชุฑููู ุบูุฑ ููุชูู ุฃู ุบูุฑ ูุงุถุญ
2. ุงููุธุงู "ูุฎูู" ุงุณู ุจูู ุจูุงุกู ุนูู ุชุดุงุจู ุฌุฒุฆู
3. ุงูููุธู ูุซู ุจุงููุชูุฌุฉ ููุญูุธ ุงูุณุฌู
4. **ุชูุฏุฎู ุจูุงูุงุช ุฎุงุทุฆุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช**

### 3. ุงูููุฏ ุงูุญุงูู

ุญุณุจ ุงูุชูุถูุญ ูู ูุงูู ุงูููุชุฌ:
> "ุฃุณูุงุก ุงูุจููู ุซุงุจุชุฉ ููุญุตูุฑุฉ ูู ุฌุฏูู ุงูุจููู ููุง ูุฌุจ ุฃู ูููู ููุงู ุฃุณูุงุก ุบูุฑ ููุฌูุฏุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช"

**ุงููุดููุฉ:** ุงููุธุงู ุงูุญุงูู ูุฏ ููุทุงุจู ูููุฉ ุนุดูุงุฆูุฉ ูุน ุงุณู ุจูู ููุฌูุฏ ูู ุงูุฌุฏูู **ุจุดูู ุฎุงุทุฆ**.

---

## ๐ก ุงูููุชุฑุญ ุงูุชูุตููู

### ุงูุญู ุงูููุตู ุจู: ูุธุงู ุชูููู ุซูุฉ ูุชุนุฏุฏ ุงููุณุชููุงุช

#### ุงููุณุชูู 1: ุชุทุงุจู ุชุงู (100% ุซูุฉ)

- ููุท ุฅุฐุง ูุงู ุงููุต ูุญุชูู ุนูู ุงุณู ุงูุจูู **ุจุงูุถุจุท** ููุง ูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ูุซุงู: "ุงูุจูู ุงูุฃููู ุงูุณุนูุฏู" โ โ ุชุทุงุจู ุชุงู ูุน `banks.arabic_name`

#### ุงููุณุชูู 2: ุชุทุงุจู ุฌุฒุฆู ููู (70%-99% ุซูุฉ)

- ุฅุฐุง ูุงู ุงููุต ูุญุชูู ุนูู ุงุณู ูุฎุชุตุฑ ุดุงุฆุน ุฃู ุงุณู ุจุฏูู ููุณุฌู
- ูุซุงู: "SNB" โ โ ุชุทุงุจู ูุน `bank_alternative_names.normalized_name`

#### ุงููุณุชูู 3: ุชุทุงุจู ุถุนูู (ุฃูู ูู 70% ุซูุฉ)

- ุฅุฐุง ูุงู ููุงู ุชุดุงุจู ุฌุฒุฆู ููุท
- **ุงูุฅุฌุฑุงุก:** โ **ุฑูุถ ุงูุงุณุชุฎุฑุงุฌ** + ุฅุธูุงุฑ ุชุญุฐูุฑ

### ุงูุชุทุจูู ุงูุนููู

#### 1. ุฅุถุงูุฉ ุญุฏ ุซูุฉ ุฃุฏูู (Minimum Confidence Threshold)

```php
// ูู ููุฏ Smart Paste Extraction
$confidenceThreshold = 70; // ุงูุญุฏ ุงูุฃุฏูู ุงูููุจูู

if ($bankMatchScore < $confidenceThreshold) {
    // ูุง ุชุนุฑุถ ูุชูุฌุฉุ ุงุนุชุจุฑ ุงูุจูู "ุบูุฑ ูุณุชุฎุฑุฌ"
    return null;
}
```

#### 2. ุนุฑุถ ุฏุฑุฌุฉ ุงูุซูุฉ ูููุณุชุฎุฏู

**ุงููุงุฌูุฉ ุงูููุชุฑุญุฉ:**

```
๐ ูุชุงุฆุฌ ุงูุงุณุชุฎุฑุงุฌ:

ุงุณู ุงูููุฑูุฏ       โ ูุณุชุฎุฑุฌ (ุซูุฉ: 95%)
ุฑูู ุงูุถูุงู        โ ูุณุชุฎุฑุฌ (ุซูุฉ: 100%)
ุงุณู ุงูุจูู         โ๏ธ ูุณุชุฎุฑุฌ (ุซูุฉ: 65%) - ูุฑุฌู ุงููุฑุงุฌุนุฉ
ุงููุจูุบ             โ ูุณุชุฎุฑุฌ (ุซูุฉ: 98%)
ุชุงุฑูุฎ ุงูุงูุชูุงุก    โ ุบูุฑ ูุณุชุฎุฑุฌ
```

**ูุงุฆุฏุฉ:** ุงููุณุชุฎุฏู ูุนุฑู ุฃู ุญูู ูุญุชุงุฌ ูุฑุงุฌุนุฉ ุฏูููุฉ

#### 3. ุฅุถุงูุฉ ุชุญุฐูุฑ ุนูุฏ ุงููุชุงุฆุฌ ุงูุถุนููุฉ

```
โ๏ธ ุชูุจูู: ุจุนุถ ุงูุจูุงูุงุช ุงููุณุชุฎุฑุฌุฉ ูุฏ ุชุญุชุงุฌ ุชุฏููู ูุฏูู.
ุงูุญููู ุฐุงุช ุงูุซูุฉ ุฃูู ูู 80% ูุญุฏุฏุฉ ุจุงูููู ุงูุจุฑุชูุงูู.
```

#### 4. ุชุญุณูู ููุทู ุงููุทุงุจูุฉ

**ุงููุงุนุฏุฉ ุงูุฌุฏูุฏุฉ:**

- **ุฃููุงู:** ุงุจุญุซ ุนู ุชุทุงุจู ุชุงู ูู `banks.arabic_name` ุฃู `banks.english_name`
- **ุซุงููุงู:** ุงุจุญุซ ูู `bank_alternative_names` ุนู ุงูุฃุณูุงุก ุงููุฎุชุตุฑุฉ ุงููุนุชูุฏุฉ
- **ุซุงูุซุงู:** ููุท ุฅุฐุง ูู ููุฌุฏ ุชุทุงุจูุ ุงุณุชุฎุฏู Fuzzy Matching ุจุญุฐุฑ
- **ุงูููุฏ:** ูุง ุชูุจู ูุชูุฌุฉ Fuzzy ุฃูู ูู 80% ุชุดุงุจู

#### 5. โ๏ธ ููุงุญุธุฉ ุญุฑุฌุฉ: ุงูุชุนุงูู ูุน ุงูููุงุตู ูู ุงูุฃุฑูุงู

**ุงููุดููุฉ:**  
ุงููุงุตูุฉ (`,`) ููุง ุงุณุชุฎุฏุงูุงู ูุฎุชููุงู ุชูุงูุงู ูู ุงูุฃุฑูุงู:

**ุงูุงุณุชุฎุฏุงู 1: ูุงุตูุฉ ุงูุขูุงู (Thousands Separator)**

```
500,000 โ ุฎูุณูุงุฆุฉ ุฃูู
1,250,000 โ ููููู ููุฆุชุงู ูุฎูุณูู ุฃูู
```

**ุงูุงุณุชุฎุฏุงู 2: ุงููุงุตูุฉ ุงูุนุดุฑูุฉ (Decimal Point)**

```
500,25 โ ุฎูุณ ูุฆุฉ ูุฎูุณุฉ ูุนุดุฑูู ูููุฉ
1,5 โ ูุงุญุฏ ููุตู
```

**ุงูุญู ุงูููุชุฑุญ:**

```php
// ูู ููุฏ ุงุณุชุฎุฑุงุฌ ุงููุจุงูุบ
function parseAmount($text) {
    // ุงููุงุนุฏุฉ: ุฅุฐุง ูุงูุช ุงููุงุตูุฉ ูุชุจูุนุฉ ุจุฑูููู ููุท โ ุนุดุฑู
    // ุฅุฐุง ูุงูุช ูุชุจูุนุฉ ุจุซูุงุซุฉ ุฃุฑูุงู ุฃู ุฃูุซุฑ โ ุขูุงู
    
    if (preg_match('/(\d+),(\d{3})/', $text)) {
        // ูุงุตูุฉ ุขูุงู: 500,000
        $amount = str_replace(',', '', $text);
    } elseif (preg_match('/(\d+),(\d{1,2})$/', $text)) {
        // ูุงุตูุฉ ุนุดุฑูุฉ: 500,25
        $amount = str_replace(',', '.', $text);
    }
    
    return floatval($amount);
}
```

**ุฃูุซูุฉ ุงุฎุชุจุงุฑ:**

- `"500,000"` โ `500000.00` โ
- `"500,25"` โ `500.25` โ
- `"1,000,000"` โ `1000000.00` โ
- `"2,5"` โ `2.5` โ

---

## ๐ฏ ุงูููุงุฆุฏ ุงููุชููุนุฉ

### 1. ุชูููู ุงูุฃุฎุทุงุก

- ูู ููุฏุฎู ุงููุธุงู ุจูุงูุงุช ุจููู ุฎุงุทุฆุฉ ุจูุงุกู ุนูู ุชุฎูููุงุช ุถุนููุฉ

### 2. ุดูุงููุฉ ุฃูุจุฑ

- ุงููุณุชุฎุฏู ูุฑู ุจูุถูุญ ูุง ูู ูุคูุฏ ููุง ูุญุชุงุฌ ูุฑุงุฌุนุฉ

### 3. ูุฑููุฉ ููุงุณุจุฉ

- ุงููุธุงู ูุง ูุฒุงู ูุนูู ูุน ูุตูุต ูุชููุนุฉ (ุญุณุจ ูุชุทูุจ ูุงูู ุงูููุชุฌ)
- ููู ูุน ุถูุงูุงุช ุฌูุฏุฉ ุฃููู

---

## ๐ ุญุงูุงุช ุงูุงุฎุชุจุงุฑ ุงูููุชุฑุญุฉ

### Case 1: ูุต ูุงุถุญ ููุงูู โ

**Input:**

```
ูุฑุฌู ุฅุตุฏุงุฑ ุถูุงู ุจููู ูุตุงูุญ ุดุฑูุฉ ุฃุฑุงููู ุงูุณุนูุฏูุฉ
ูู ุงูุจูู ุงูุฃููู ุงูุณุนูุฏู ุจูุจูุบ 500,000 ุฑูุงู
```

**Expected:**

- ุงูููุฑูุฏ: โ (100%)
- ุงูุจูู: โ (100%)
- ุงููุจูุบ: โ (100%)

### Case 2: ูุต ุบุงูุถ โ๏ธ

**Input:**

```
ูุญุชุงุฌ ุถูุงู ูููุดุฑูุน ุจูููุฉ ูุตู ููููู ูู ุฃุญุฏ ุงูุจููู ุงููุจุฑู
```

**Expected:**

- ุงููุจูุบ: โ (85%) - "ูุตู ููููู" = 500,000
- ุงูุจูู: โ - "ุงูุจููู ุงููุจุฑู" ุบุงูุถ ุฌุฏุงู

### Case 3: ูุต ุนุดูุงุฆู โ

**Input:**

```
ูุฐุง ูุฌุฑุฏ ูุต ุชุฌุฑูุจู ููุงุฎุชุจุงุฑ
```

**Expected:**

- ุฌููุน ุงูุญููู: โ ุบูุฑ ูุณุชุฎุฑุฌ
- ุฑุณุงูุฉ: "ูู ูุชู ุงูุชุนุฑู ุนูู ุจูุงูุงุช ุถูุงู"

---

## ๐๏ธ ุฎุทูุงุช ุงูุชูููุฐ ุงูููุชุฑุญุฉ

### Phase 1: Backend Logic

1. ุฅุถุงูุฉ ุญุณุงุจ `confidence_score` ููู ุญูู ูุณุชุฎุฑุฌ
2. ุชุทุจูู `threshold = 70%` ูุญุฏ ุฃุฏูู
3. ุชุญุฏูุซ API ูููุฑุฌุน ุฏุฑุฌุฉ ุงูุซูุฉ ูุน ูู ุญูู

### Phase 2: Frontend Display

1. ุชุญุฏูุซ ุงูุฌุฏูู (Status Grid) ููุนุฑุถ ุงููุณุจุฉ ุงููุฆููุฉ
2. ุฅุถุงูุฉ ุฃููุงู: ุฃุฎุถุฑ (>80%)ุ ุจุฑุชูุงูู (70-80%)ุ ุฃุญูุฑ (<70%)
3. ุฅุถุงูุฉ ุฑุณุงูุฉ ุชุญุฐูุฑ ุนุงูุฉ

### Phase 3: Testing

1. ุงุฎุชุจุงุฑ ูุน 50 ุนููุฉ ูุต ูุชููุนุฉ
2. ููุงุณ ูุนุฏู ุงูุฏูุฉ (Accuracy)
3. ุถุจุท ุงูุนุชุจุงุช ุญุณุจ ุงููุชุงุฆุฌ

---

## ๐ ุงูุฎูุงุตุฉ

**ุงููุดููุฉ ุงูุฌููุฑูุฉ:** ุงููุธุงู ุงูุญุงูู "ูุชูุงุฆู ุฌุฏุงู" ูู ูุญุงููุฉ ุงุณุชุฎุฑุงุฌ ุงูุจูุงูุงุช

**ุงูุญู:** ุฅุถุงูุฉ ุทุจูุฉ ุชูููู ุซูุฉ + ุญุฏ ุฃุฏูู ูุฑูุถ ุงููุชุงุฆุฌ ุงูุถุนููุฉ

**ุงููุชูุฌุฉ:** ูุธุงู ูุตู ุฐูู **ุฏููู** ู**ุดูุงู** ููุง ููุฏุฎู ุจูุงูุงุช ุฎุงุทุฆุฉ

---

**ุงููุฑุฌุน:** ูุชุงุฆุฌ ุงูุงุฎุชุจุงุฑ ุงูุชุดุบููู - 14 ููุงูุฑ 2026

๐ Impact Analysis Required โ Smart Paste Confidence Layer

Before implementing the Smart Paste confidence changes, I need a clear technical impact analysis based on the real code โ not assumptions.

Please provide the following:

1. Behavioral Impact

List all functions / services involved in:

Bank extraction

Similarity scoring

Match selection

Auto-fill logic

Save flow impact

For each component:

Component Current Behavior Expected Behavior After Change Risk Level
2. Preservation Plan (Regression Safety)

Identify which existing logic must NOT be modified because it is proven stable, such as:

Normalization

Synonym handling

Amount parsing

Date extraction

Existing heuristics

Explain how the confidence logic will be added as a wrapper or layer without changing these internal behaviors.

1. Complexity Assessment

Provide:

Number of files impacted

Any API contract changes

Any function signature changes

Whether schema changes are needed (expected: no)

Whether feature flagging will be used

Estimated effort by complexity (Low / Medium / High)

1. Blast Radius Analysis

Identify any potential side effects on:

Import workflows

Manual data entry

Validation layer

Audit logs

Reporting

Learning / suggestion pipelines

Performance

Explain mitigation for each risk.

1. Safe Rollout Plan

Propose:

Feature flag strategy

Shadow run (dual execution) if applicable

Regression test strategy

Rollback strategy

This analysis must be grounded in actual code paths and file references.
