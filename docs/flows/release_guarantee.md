# Flow: إفراج / تحرير ضمان (release_guarantee)

## الهدف
إغلاق ضمان نشط بعد استيفاء الشروط، مع تسجيل الأثر.

## المسار الأساسي
1) الطلب: `/api/release.php` مع (guarantee_id, reason?).
2) التحقق:
   - الضمان موجود وحالته active.
3) التنفيذ:
   - تحديث status إلى released.
   - تسجيل حركة Audit مع السبب.
4) المخرجات:
   - JSON نجاح، status=released.
   - حدث runtime_events `guarantee_released`.

## الأخطاء الشائعة
- ضمان غير نشط أو بالفعل released → 422.
- صلاحيات ناقصة → 403.

## الحواجز
- Audit trail إلزامي.
- منع release إذا هناك مرفقات حرجة ناقصة (إن وجدت قاعدة تجارية).

## معايير القبول
- محاولة release لضمان غير Active تعيد 422.
- إفراج ناجح يظهر في الأحداث ويختفي من قوائم الضمانات النشطة.
