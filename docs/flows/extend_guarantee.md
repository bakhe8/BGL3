# Flow: تمديد ضمان (extend_guarantee)

## الهدف
تمديد فترة ضمان قائم دون تغيير بدايته أو كسر القواعد المالية.

## المسار الأساسي
1) الطلب: `/api/extend.php` مع (guarantee_id, new_end_date, reason?).
2) التحقق:
   - الضمان موجود وحالته active.
   - new_end_date > end_date الحالية.
3) التنفيذ:
   - تحديث end_date، وتسجيل حركة (audit) مع السبب والزمن.
4) المخرجات:
   - JSON نجاح مع end_date الجديد.
   - حدث runtime_events `guarantee_extended`.

## الأخطاء الشائعة
- ضمان غير نشط → 422.
- تاريخ غير صالح أو ليس أكبر من الحالي → 422.
- صلاحيات ناقصة → 403.

## الحواجز
- Rate limit لمسارات الكتابة.
- Audit trail لتسجيل التمديد.
- Validation للتواريخ.

## معايير القبول
- محاولة تمديد ضمان expired → 422 برسالة واضحة.
- تمديد ناجح يسجَّل في الأحداث والتجارب ويعود end_date جديدة.
