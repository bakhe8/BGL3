# خريطة ترابط قدرات الوكيل (Dependency Map)

**الهدف:** توحيد النقاط المتداخلة في محاور تنفيذ واضحة، وترتيب العمل بطريقة تمنع التعارض وتزيد الأثر التراكمي.

---

## 1) خريطة الترابط (منطق السبب والنتيجة)

**A. الاستكشاف وفهم الواجهة**
- يعتمد على: 
  - جمع إشارات UI semantic
  - تسجيل runtime_events
- يؤثر على:
  - جودة القرار
  - قياس الأثر
  - توليد أهداف جديدة

**B. القياس السببي (Attribution)**
- يعتمد على:
  - runtime_events
  - قرارات/نتائج محفوظة
  - snapshots
- يؤثر على:
  - تصحيح الفهم
  - منع التوسع الخاطئ
  - تغذية حلقة التعلم

**C. القرار الحتمي + قواعد المجال**
- يعتمد على:
  - قواعد المجال (domain_rules)
  - نتائج القياس السببي
  - مؤشرات الحالة
- يؤثر على:
  - السماح/المنع
  - ضبط التوسع الذاتي

**D. التعلم التراكمي**
- يعتمد على:
  - outcomes
  - proposals
  - الروابط السببية
- يؤثر على:
  - تعديل النية
  - تطوير قواعد القرار
  - جدولة الأهداف

**E. الأهداف طويلة المدى**
- يعتمد على:
  - التعلم التراكمي
  - القياس السببي
  - الحاجة التشغيلية الفعلية
- يؤثر على:
  - تخطيط السيناريوهات
  - ترتيب الأولويات

---

## 2) محاور التنفيذ (Spines)

### Spine 1: القياس السببي + السجل الموحد
**الهدف:** منع التوسع الخاطئ عبر ربط التغييرات بمصدرها (اختبار/تعديل/خارجي).

**يخدم:**  
القرار الحتمي، التعلم، الأهداف، جودة الاستكشاف.

---

### Spine 2: القرار الحتمي + قواعد المجال
**الهدف:** جعل قرارات الوكيل قابلة للتنبؤ وضبطها بقواعد صارمة قبل LLM.

**يخدم:**  
الاستقرار، منع التعارضات المنطقية، حماية الإنتاج.

---

### Spine 3: فهم UI والتفاعل الفعلي
**الهدف:** رفع جودة الاستكشاف والتفاعل ليكون مبنيًا على فهم المعنى لا مجرد أزرار.

**يخدم:**  
القياس السببي، القرار، التعلم.

---

### Spine 4: التعلم التراكمي + تعديل النية
**الهدف:** ربط النتائج بالتغيرات الفعلية في سلوك الوكيل (intent/policy updates).

**يخدم:**  
تحديث النية، تحسين الاستكشاف، ثبات التوسع.

---

### Spine 5: الأهداف طويلة المدى
**الهدف:** تحويل السلوك من ردّ فعل إلى تخطيط حقيقي مبني على المعرفة السابقة.

**يخدم:**  
جودة التطور، تجنب التكرار، خطط أكثر واقعية.

---

## 3) ترتيب التنفيذ المرحلي (يغطي كل النقاط الحرجة)

### شرط التمكين الكامل
لا تُمنح القدرة الكاملة للوكيل إلا بعد اكتمال الطبقات التالية:
- قياس سببي مكتمل + ربط واضح لكل قرار بنتيجة.
- قرار حتمي مقيد بقواعد المجال مع تفسير قرار واضح للمستخدم.
- فهم UI أعمق + تغطية سيناريوهات منهجية تسد الفجوات تلقائيًا.
- تنقية معرفة فعّالة (حل تضارب المعرفة وترجيحها).
- مسار نشر آمن للإنتاج (Canary/Rollback).

### المرحلة 1 — تثبيت البيانات والسببية (Spine 1)
- إكمال القياس السببي وربط التغييرات بمصدرها.
- ضمان أن كل قرار لديه ربط واضح مع outcome.
- يضع الأساس لإغلاق الحلقة لاحقًا.

### المرحلة 2 — القرار الحتمي + قواعد المجال + تفسير القرار (Spine 2)
- توسيع القواعد الحتمية الحالية لتقييد القرارات عالية المخاطر.
- تفسير القرار للمستخدم (أسباب + بدائل + أثر متوقّع).
- منع التضارب المنطقي مع domain_rules.

### المرحلة 3 — الاستكشاف والفهم + تغطية السيناريوهات (Spine 3)
- تطوير فهم UI ليبني نموذج سلوك/تدفّق أعمق.
- منهجية تغطية السيناريوهات + توليد فجوات تلقائيًا.

### المرحلة 4 — التعلم التراكمي + تنقية المعرفة (Spine 4)
- إغلاق الحلقة الذاتية بالكامل: اقتراح → تنفيذ → قياس → تحديث قواعد/نية.
- تنقية المعرفة وحل التضارب والترجيح.

### المرحلة 5 — الأهداف طويلة المدى (Spine 5)
- سياسة جدولة/أولوية متعلمة ومستمرّة للأهداف.
- ربط الأهداف بنتائج القياس السببي والتعلم.

### المرحلة 6 — نشر آمن للإنتاج (Canary/Rollback)
- مسار نشر تدريجي مع نقاط تراجع تلقائية.
- تقليل المخاطر التشغيلية قبل التوسّع.

---

## 4) لماذا هذا الترتيب؟

لأن كل مرحلة تعتمد منطقيًا على التي قبلها:
بدون قياس سببي دقيق = التعلم سيكون خاطئ.  
بدون قواعد قرار حتمية + تفسير واضح = القرارات تصبح غير قابلة للضبط.  
بدون فهم UI وتغطية منهجية = سيناريوهات ناقصة وأهداف غير واقعية.  
بدون تنقية المعرفة = التعلم يتراكم بشكل خاطئ.  

---

## 5) الخطوة التالية

**الخطوة التالية المقترحة:**
- توسيع القواعد الحتمية لتشمل قواعد المجال (مثلاً R001/R002) وتثبيتها في قرار التنفيذ.
- الانتقال للمرحلة 3: فهم UI أعمق + تغطية سيناريوهات منهجية.
