# ADR-001: Security Controls Out of Scope (By Context)

**ุงูุญุงูุฉ**: โ ููุนุชูุฏ (Accepted)  
**ุงููุทุงู**: BGL3 โ Local Single-User Mode  
**ุงูุชุงุฑูุฎ**: 2026-01-13  
**ููุน ุงููุฑุงุฑ**: Context-Bound Architectural Exception

---

## 1๏ธโฃ ุงูุณูุงู (Context)

ูุธุงู BGL3 ููุตูู ูููุดุบููู ููู ุงูุฎุตุงุฆุต ุงูุชุงููุฉ:

### ุฎุตุงุฆุต ุงููุดุฑ

- โ **ุชุดุบูู ูุญูู ููุท** ุนูู ุฌูุงุฒ ุดุฎุตู
- โ **ูุณุชุฎุฏู ูุงุญุฏ ููุท**
- โ **ูุง ููุฌุฏ**:
  - ุงุณุชุถุงูุฉ ุฎุงุฑุฌูุฉ
  - ูุตูู ุดุจูู
  - ุชุนุฏุฏ ูุณุชุฎุฏููู
  - ูุดุงุฑูุฉ ุฌูุณุงุช

### ูููุฐุฌ ุงูุชูุฏูุฏ (Threat Model)

ุฌููุน ูุงุฌูุงุช API (ุจูุง ูููุง `save-and-next.php`) ุชุนูู ุถูู ุณูุงู ูุญูู ูุบูู:

- ูุง ููุฌุฏ ุทุฑู ุฎุงุฑุฌู ูุญุชูู
- ูุง ุชูุฌุฏ ุดุจูุฉ ุนุงูุฉ
- ุงููุณุชุฎุฏู ุงููุญูุฏ ูู ุงููุดุบูู ูููุธุงู

---

## 2๏ธโฃ ุงููุฑุงุฑ (Decision)

ุชู **ุงุณุชุจุนุงุฏ** ุงููุชุทูุจุงุช ุงูุฃูููุฉ ุงูุชุงููุฉ ูู ูุทุงู ุงููุธุงู ุงูุญุงูู:

| ุงููุชุทูุจ | ุงูุญุงูุฉ | ุงููุจุฑุฑ |
|---------|--------|--------|
| CSRF Protection | โ ุฎุงุฑุฌ ุงููุทุงู | ูุง ููุฌุฏ ุทุฑู ุฎุงุฑุฌู ูุชูููุฐ CSRF |
| Authentication / Authorization | โ ุฎุงุฑุฌ ุงููุทุงู | ูุณุชุฎุฏู ูุงุญุฏ ููุท |
| Error Message Masking | โ ุฎุงุฑุฌ ุงููุทุงู | ูุง ุชูุฌุฏ ูุนูููุงุช ุญุณุงุณุฉ ูุนุฑุถุฉ ูุทุฑู ุซุงูุซ |
| Session Management | โ ุฎุงุฑุฌ ุงููุทุงู | ูุง ุชูุฌุฏ ุฌูุณุงุช ูุชุนุฏุฏุฉ |
| Rate Limiting | โ ุฎุงุฑุฌ ุงููุทุงู | ูุง ููุฌุฏ ุงุณุชุฎุฏุงู ุดุจูู |

**ุงูุณุจุจ ุงูุฌููุฑู**: ูุฐู ุงููุชุทูุจุงุช ุชูุชุฑุถ ูุฌูุฏ **ุงุณุชูุฏุงู ุฃู ุทุฑู ุฎุงุฑุฌู**ุ ููู ุงูุชุฑุงุถ ุบูุฑ ูุงูุนู ูุบูุฑ ููุทูู ูู ุณูุงู ุงูุชุดุบูู ุงููุนุชูุฏ.

---

## 3๏ธโฃ ุงููุจุฑุฑุงุช (Rationale)

### ููุงุฐุง ูุฐุง ุงููุฑุงุฑ ุตุญูุญุ

#### ุฃ) ูุง ููุฌุฏ ูููุฐุฌ ุชูุฏูุฏ ูุนูู

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Single User on Local Machine      โ
โ                                     โ
โ  โโโโโโโโโโโ        โโโโโโโโโโโโ  โ
โ  โ Browser โ โโโโโ> โ PHP App  โ  โ
โ  โโโโโโโโโโโ        โโโโโโโโโโโโ  โ
โ                           โ        โ
โ                      โโโโโโผโโโโโ  โ
โ                      โ SQLite  โ  โ
โ                      โโโโโโโโโโโ  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
         No External Access
         No Network Exposure
         No Threat Actor
```

#### ุจ) ูุง ููุฌุฏ ุณุทุญ ูุฌูู ูุงูุนู

- **CSRF Attack**: ูุชุทูุจ ุถุญูุฉ ูุฒูุฑ ูููุน ุฎุจูุซ โ ูุง ููุทุจู (ูุณุชุฎุฏู ูุงุญุฏ)
- **Unauthorized Access**: ูุชุทูุจ ูุณุชุฎุฏู ุซุงูู โ ูุง ููุฌุฏ
- **Information Disclosure**: ูุชุทูุจ ุทุฑู ุฎุงุฑุฌู โ ูุง ููุฌุฏ

#### ุฌ) ูุฑุถ ูุฐู ุงูุขููุงุช

- โ **ูุง ูุถูู ูููุฉ ุชุดุบูููุฉ**
- โ **ูุง ูุญุณู ุงูุฃุฏุงุก**
- โ **ูุง ูุญู ูุดููุฉ ูุงุฆูุฉ**
- โ **ููุนุฏ ุชุนููุฏูุง ุบูุฑ ูุจุฑุฑ** (Over-Engineering)

---

## 4๏ธโฃ ุงูุขุซุงุฑ ุงููุชุฑุชุจุฉ (Consequences)

### โ ุงูุฅูุฌุงุจูุงุช

1. **ุชุจุณูุท ุงูููุฏ**

   ```php
   // โ Clean & Simple
   $input = json_decode(file_get_contents('php://input'), true);
   
   // vs
   
   // โ Unnecessary Complexity
   if (!validateCsrfToken($_POST['csrf_token'])) {
       die('Invalid CSRF token');
   }
   ```

2. **ุงูุญูุงุธ ุนูู ูุถูุญ ุงููุธุงู**
   - ููุฏ ุฃูู = bugs ุฃูู
   - ููุทู ูุจุงุดุฑ ุจุฏูู ุทุจูุงุช ููููุฉ

3. **ุนุฏู ุฅุฏุฎุงู ููุทู ุบูุฑ ูุณุชุฎุฏู**
   - ูุง sessions ุบูุฑ ุถุฑูุฑูุฉ
   - ูุง tokens ุบูุฑ ูุทููุจุฉ

4. **ุงูุชุฑููุฒ ุนูู ุงููุถุงูุง ุงููุนููุฉ**
   - ุงูุฃุฏุงุก
   - ุงูุตูุงูุฉ
   - ููุทู ุงูุนูู
   - ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู

### โ๏ธ ุงูุณูุจูุงุช ุงูููุจููุฉ

**ูู ุญุงู ุชุบููุฑ ุงูุณูุงู ูุณุชูุจููุง** (ูุดุฑ ุดุจูู / ุชุนุฏุฏ ูุณุชุฎุฏููู):

- ูุฌุจ ุฅุนุงุฏุฉ ูุชุญ ูุฐุง ุงููุฑุงุฑ
- ูุชุทุจูู ูุชุทูุจุงุช ุงูุฃูู ุญูููุง
- **Cost of Change**: ูุชูุณุท (~3-5 ุฃูุงู ุนูู)

---

## 5๏ธโฃ ุดุฑุท ุฅุนุงุฏุฉ ุงูุชูููู (Revisit Condition)

**ููุนุงุฏ ูุชุญ ูุฐุง ุงููุฑุงุฑ ููุท ุฅุฐุง ุชุญูู ุฃุญุฏ ุงูุดุฑูุท ุงูุชุงููุฉ:**

| ุงูุดุฑุท | ุงููุตู | ุงูุชุฃุซูุฑ |
|-------|-------|---------|
| ๐ **Network Deployment** | ุชุดุบูู ุงููุธุงู ุนุจุฑ ุงูุดุจูุฉ (LAN/WAN) | ูุชุทูุจ CSRF + Auth |
| ๐ฅ **Multi-User** | ุฅุถุงูุฉ ูุณุชุฎุฏู ุซุงูู ุฃู ุฃูุซุฑ | ูุชุทูุจ Auth + Permissions |
| โ๏ธ **Cloud/Hosting** | ูุดุฑ ุนูู ุงุณุชุถุงูุฉ ุฎุงุฑุฌูุฉ | ูุชุทูุจ ูุงูุฉ ุงูุถูุงุจุท |
| ๐ **API Exposure** | ูุชุญ APIs ูุชุทุจููุงุช ุฎุงุฑุฌูุฉ | ูุชุทูุจ API Keys + OAuth |

**ุฎูุงู ุฐูู**: ูุจูู ุงููุฑุงุฑ **ูุบูููุง ูููุงุฆููุง** โ

---

## 6๏ธโฃ ุงูุญุงูุฉ ุงูููุงุฆูุฉ

### ุชุตููู ุงููุฑุงุฑ

```
๐ ุงูุฃูู ุงูุดุจูู ุฎุงุฑุฌ ุงููุทุงู ุจุณุจุจ ุงูุณูุงู
   โโ โ ููุณ ููุทุฉ ุถุนู
   โโ โ ููุณ ุฏูููุง ุชููููุง
   โโ โ ููุณ ูุทููุจูุง ุญุงูููุง
   โโ โ ูุฑุงุฑ ูุนูุงุฑู ูุจุฑุฑ ุจุงูุณูุงู
```

### ุงูุฑุณุงูุฉ ูููุฑุงุฌุนูู

ุฅุฐุง ูุฑุฃุช ุชูุฑูุฑูุง ูุฐูุฑ "ุนุฏู ูุฌูุฏ CSRF Protection" ูููุทุฉ ุถุนู:

1. โ **ุงูุฑุฃ ูุฐุง ุงูู ADR ุฃููุงู**
2. โ **ููู ุงูุณูุงู** (Local Single-User)
3. โ **ุทุจูู ูููุฐุฌ ุงูุชูุฏูุฏ ุงูุตุญูุญ**
4. โ **ูุง ุชุทุจู ูุนุงููุฑ ุนุงูุฉ ุจุฏูู ููู ุงูุณูุงู**

---

## 7๏ธโฃ ุงููุฑุงุฌุน ูุงููุตุงุฏุฑ

### ูุนุงููุฑ ุงูุฃูู ุฐุงุช ุงูุตูุฉ

- **OWASP Top 10**: ููุทุจู ุนูู **Web Applications** ุงููุนุฑุถุฉ ููุดุจูุฉ
- **SANS Top 25**: ููุทุจู ุนูู **Multi-User Systems**
- **CWE-352 (CSRF)**: ูุชุทูุจ ูุฌูุฏ **ุถุญูุฉ ูุญุชููุฉ**

**ุงูุงุณุชูุชุงุฌ**: BGL3 ูุง ููุน ุชุญุช ุฃู ูู ูุฐู ุงููุฆุงุช ูู ูุถุนู ุงูุญุงูู.

### ูุฑุงุฑุงุช ูุดุงุจูุฉ

- **Desktop Applications**: ูุง ุชุทุจู CSRF
- **Offline Tools**: ูุง ุชุทุจู Authentication
- **Single-User Software**: ูุง ุชุทุจู Authorization

---

## 8๏ธโฃ ุงูุชูููุนุงุช

**ุตุงุญุจ ุงููุฑุงุฑ**: Bakheet (Project Owner)  
**ุงูุชุงุฑูุฎ**: 2026-01-13  
**ุงูุญุงูุฉ**: โ Accepted & Closed

---

**ุชู ุชุซุจูุช ุงููุฑุงุฑ ูุฅุบูุงู ุงูููุงุด ููุงุฆููุง** โ

---

## Appendix A: Migration Path (ุฅุฐุง ุชุบูุฑ ุงูุณูุงู)

```php
// Phase 1: Add CSRF (if network deployment)
class CsrfProtection {
    public static function generateToken(): string {
        if (!isset($_SESSION['csrf_token'])) {
            $_SESSION['csrf_token'] = bin2hex(random_bytes(32));
        }
        return $_SESSION['csrf_token'];
    }
    
    public static function validate(string $token): bool {
        return hash_equals($_SESSION['csrf_token'] ?? '', $token);
    }
}

// Phase 2: Add Authentication (if multi-user)
class Auth {
    public static function check(): bool {
        return isset($_SESSION['user_id']);
    }
    
    public static function user(): ?array {
        if (!self::check()) return null;
        // Load user from DB
    }
}
```

**Estimated Effort**: 3-5 days
